{"version":3,"sources":["../../src/components/Route.js"],"names":["Route","routeLocation","args","kwargs","childLocation","currentMatch","previousKwargs","_props","_context","props","context","absolute","getChildLocation","routing","location","pathname","bind","getRouteLocation","matchedRoute","routeArgs","cloneDeep","getRouteKwargs","getKwargs","routePath","getRoutePath","parentKwargs","Object","assign","name","path","flag","setMatch","getSubRouteLocation","matchInfo","matchString","isMatched","dispatch","absName","nextProps","nextState","nextContext","matched","update","isEqual","updateProps","children","type","component","cloneElement","Array","isArray","className","Component","childContextTypes","PropTypes","func","object","array","string","state"],"mappings":"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","file":"Route.js","sourcesContent":["/**\n * Created by sidchik on 28.03.17.\n */\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport _ from 'lodash';\nimport { getRegs, getMatchInfo } from '../helpers/matcher';\nimport { setRouteKwargs } from '../actions/routing';\nimport { addRoutingContext } from '../helpers/context';\n\nclass Route extends React.Component {\n\n    routeLocation = '/'\n    args = [];\n    kwargs = {};\n    childLocation = null;\n    currentMatch = false;\n\n    getSubRouteLocation(_props, _context) {\n        let props = _props || this.props;\n        let context = _context || this.context;\n        if (!props.absolute) return (context.getChildLocation ? context.getChildLocation() : '') || props.routing.location.pathname;\n\n        return props.routing.location.pathname;\n    }\n\n\n    getChildContext() {\n        return {\n            getChildLocation: this.getChildLocation.bind(this),\n            getRouteLocation: this.getRouteLocation.bind(this),\n            matchedRoute: this,\n            routeArgs: _.cloneDeep(this.args),\n            getRouteKwargs: this.getKwargs.bind(this),\n            routePath: this.getRoutePath()\n        };\n    }\n\n    getChildLocation() {\n        return this.childLocation;\n    }\n\n    getRouteLocation() {\n        return this.routeLocation;\n    }\n\n    getKwargs() {\n        let parentKwargs = this.context.getRouteKwargs ? this.context.getRouteKwargs() : null || {};\n        return Object.assign({}, parentKwargs, _.cloneDeep(this.kwargs));\n    }\n\n    getRoutePath() {\n        let name = this.props.name ? (this.props.name + '/') : '';\n        return (this.context.routePath ? this.context.routePath : '') + (name || this.props.path);\n    }\n\n\n    setMatch(flag) {\n        this.currentMatch = flag;\n        return flag;\n    }\n\n    isMatched() {\n        if (!this.props.path) return this.setMatch(true);\n        let location = this.getSubRouteLocation();\n\n        this.args = [];\n        this.kwargs = {};\n        let matchInfo = getMatchInfo(location, this.props.path);\n\n        if (!matchInfo) return this.setMatch(false);\n        this.args = matchInfo.args;\n        this.kwargs = matchInfo.kwargs;\n        this.childLocation = matchInfo.childLocation;\n        this.routeLocation = (this.context.getRouteLocation?this.context.getRouteLocation():'') + matchInfo.matchString;\n        return this.setMatch(true);\n    }\n\n    componentDidMount() {\n        // this.currentMatch = false;\n    }\n\n    componentWillMount() {\n        this.isMatched();\n        this.currentMatch = false;\n        this.previousKwargs = this.kwargs;\n        this.props.dispatch(setRouteKwargs(this.getRoutePath(), this.props.absName, this.getKwargs()));\n    }\n\n    componentWillUnmount() {\n        this.currentMatch = false;\n    }\n\n    previousKwargs = {};\n\n    shouldComponentUpdate(nextProps, nextState, nextContext) {\n        if (!nextProps.path) return true;\n        let location = this.getSubRouteLocation(nextProps, nextContext);\n\n        let matchInfo = getMatchInfo(location, nextProps.path);\n        let matched = matchInfo !== false;\n        if (matched) {\n            this.args = matchInfo.args;\n            this.kwargs = matchInfo.kwargs;\n            this.childLocation = matchInfo.childLocation;\n        }\n\n        let update = this.currentMatch !== matched;\n        if (!update && matched) {\n            if (!_.isEqual(this.kwargs, this.previousKwargs)) {\n                this.previousKwargs = this.kwargs;\n                update = true;\n                this.props.dispatch(setRouteKwargs(this.getRoutePath(), nextProps.absName, this.getKwargs()));\n            }\n        }\n        return update;\n    }\n\n    componentWillUpdate() {\n        this.props.dispatch(setRouteKwargs(this.getRoutePath(), this.props.absName, this.getKwargs()));\n    }\n\n    render() {\n        if (this.isMatched()) {\n            let updateProps = {};\n\n            if (this.props.path && typeof(this.props.children.type) === 'function') {\n                updateProps['kwargs'] = this.getKwargs();\n            }\n\n            if (this.props.component) return React.cloneElement(this.props.component, updateProps);\n\n            if (Array.isArray(this.props.children)) return <div\n                className={this.props.className}>{this.props.children}</div>;\n\n            if (this.props.children) return React.cloneElement(this.props.children, updateProps);\n        }\n        return null;\n    }\n}\n\nRoute.childContextTypes = {\n    getChildLocation: React.PropTypes.func,\n    getRouteLocation: React.PropTypes.func,\n    matchedRoute: React.PropTypes.object,\n    routeArgs: React.PropTypes.array,\n    getRouteKwargs: React.PropTypes.func,\n    routePath: React.PropTypes.string,\n};\n\n\naddRoutingContext(Route);\nexport default connect(state => ({ routing: state.routing }))(Route);"]}